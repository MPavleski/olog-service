<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mappings.PropertyMapping">
  
    <resultMap id="propertyResultMap" type="Property">
        <id property="id" column="id" /> 
        <result property="name" column="name" /> 
        <collection property="attributes" ofType="HashMap" resultMap="attributesResultMap" />
    </resultMap>
    
    <resultMap id="attributesResultMap" type="HashMap">
        <result property="key" column="attr_name" />
        <result property="value" column="attr_value" />
    </resultMap>
   
  <!-- SELECT -->
  <select id="lastId" resultType="int">
        <![CDATA[
            SELECT LAST_INSERT_ID() as propId;
        ]]>
    </select>
  
    
  <!-- UPDATE -->

    
  <!-- INSERT -->
    <insert id="addProperty" parameterType="HashMap">
        <![CDATA[
            INSERT INTO properties (log_id, name) VALUES (#{lid}, #{name})
        ]]>
    </insert>
    
    <insert id="addPropertyAttribute" parameterType="HashMap">
        <![CDATA[
            INSERT INTO attributes (property_id, name, value) VALUES (#{pid}, #{name}, #{value})
        ]]>
    </insert>

  
</mapper>